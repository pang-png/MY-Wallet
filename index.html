<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #4a90e2; --income: #2ecc71; --expense: #e74c3c; --saving: #f39c12; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .grade-card { padding: 20px; border-radius: 15px; text-align: center; color: white; margin-bottom: 20px; transition: 0.5s; }
        .grade-letter { font-size: 4.5rem; font-weight: bold; margin: 0; }
        .status-A { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .status-B { background: linear-gradient(135deg, #a2d240, #8eb233); }
        .status-C { background: linear-gradient(135deg, #f1c40f, #f39c12); color: #333; }
        .status-D { background: linear-gradient(135deg, #e67e22, #d35400); }
        .status-F { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        /* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° */
        .savings-goal-card { background: #e8f5e9; border: 1px solid var(--income); padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        .savings-goal-card b { color: #2e7d32; font-size: 1.2rem; }

        .stats { display: flex; justify-content: space-around; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 15px; }
        .top-five { background: #fff5f5; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #ffe3e3; }
        .top-five h4 { margin-top: 0; color: var(--expense); border-bottom: 1px solid #ffcfcf; padding-bottom: 5px; }
        .top-item { display: flex; justify-content: space-between; font-size: 0.9rem; padding: 3px 0; }

        input, select, button { width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 1rem; box-sizing: border-box; outline: none; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; border-bottom: 4px solid #357abd; }
        button:active { border-bottom: 0; transform: translateY(4px); }
        
        .item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .delete-btn { color: #ccc; cursor: pointer; font-size: 0.7rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="gradeBox" class="grade-card status-C">
        <div style="font-weight: bold;">‡πÄ‡∏Å‡∏£‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
        <div id="gradeLetter" class="grade-letter">-</div>
        <div id="gradeLabel" style="font-size: 1.1rem; font-weight: bold;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
    </div>

    <div id="savingsGoalBox" class="savings-goal-card" style="display:none;">
        <div id="savingsAnalysis"></div>
    </div>

    <div class="stats">
        <div>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö<br><b id="totalInc" style="color:var(--income)">0</b></div>
        <div>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢<br><b id="totalExp" style="color:var(--expense)">0</b></div>
        <div>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠<br><b id="totalBal">0</b></div>
    </div>

    <div style="position: relative; margin: auto; height:250px; width:100%">
        <canvas id="myChart"></canvas>
    </div>

    <div id="topSection" class="top-five" style="display:none; margin-top: 20px;">
        <h4>üî• 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h4>
        <div id="topList"></div>
    </div>

    <div style="margin-top: 20px;">
        <input type="text" id="desc" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å)">
        <input type="text" id="amt" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" oninput="formatNumber(this)">
        <select id="type">
            <option value="exp">üî¥ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡πÅ‡∏î‡∏á)</option>
            <option value="inc">üü¢ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)</option>
        </select>
        <button id="addBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
    </div>

    <div id="historyList" style="margin-top:20px;"></div>
    <button onclick="resetData()" style="background:none; color:#bbb; border:none; margin-top:40px; font-size:0.7rem; width:100%;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('my_wallet_v7')) || [];
    let chartObj = null;

    function formatNumber(input) {
        let value = input.value.replace(/\D/g, "");
        input.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function render() {
        const list = document.getElementById('historyList');
        let inc = 0, exp = 0;
        let expensesOnly = [];
        list.innerHTML = '<b>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥:</b>';

        db.forEach((item, index) => {
            if(item.type === 'inc') inc += item.amt; 
            else { 
                exp += item.amt;
                expensesOnly.push(item);
            }
            list.innerHTML += `
                <div class="item">
                    <span>${item.desc}</span>
                    <div style="text-align:right">
                        <b style="color:${item.type==='inc'?'#2ecc71':'#e74c3c'}">${item.amt.toLocaleString()}</b>
                        <br><span class="delete-btn" onclick="deleteItem(${index})">‡∏•‡∏ö</span>
                    </div>
                </div>`;
        });

        const balance = inc - exp;
        document.getElementById('totalInc').innerText = inc.toLocaleString();
        document.getElementById('totalExp').innerText = exp.toLocaleString();
        document.getElementById('totalBal').innerText = balance.toLocaleString();

        updateSavingsGoal(inc, balance);
        updateTopFive(expensesOnly);
        updateGrade(inc, exp);
        updateChart(db);
    }

    function updateSavingsGoal(inc, balance) {
        const box = document.getElementById('savingsGoalBox');
        const analysisEl = document.getElementById('savingsAnalysis');

        if (inc <= 0) { box.style.display = 'none'; return; }
        
        box.style.display = 'block';
        const targetSaving = inc * 0.10;

        if (balance >= targetSaving) {
            box.style.background = "#e8f5e9";
            box.style.borderColor = "var(--income)";
            analysisEl.innerHTML = `‚úÖ <b>‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</b><br>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ <b>${balance.toLocaleString()}</b> ‡∏ö‡∏≤‡∏ó`;
            analysisEl.style.color = "#2e7d32";
        } else if (balance > 0) {
            box.style.background = "#fff3e0";
            box.style.borderColor = "#ff9800";
            analysisEl.innerHTML = `‚ö†Ô∏è ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 10% (${targetSaving.toLocaleString()})<br>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏£‡∏¥‡∏á: <b>${balance.toLocaleString()}</b> ‡∏ö‡∏≤‡∏ó`;
            analysisEl.style.color = "#e65100";
        } else {
            box.style.background = "#ffebee";
            box.style.borderColor = "var(--expense)";
            analysisEl.innerHTML = `‚ùå <b>‡∏ß‡∏¥‡∏Å‡∏§‡∏ï! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏•‡∏¢</b><br>‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏•‡∏ö/‡∏®‡∏π‡∏ô‡∏¢‡πå: <b>${balance.toLocaleString()}</b> ‡∏ö‡∏≤‡∏ó`;
            analysisEl.style.color = "#c62828";
        }
    }

    function updateTopFive(expenses) {
        const section = document.getElementById('topSection');
        const list = document.getElementById('topList');
        if (expenses.length === 0) { section.style.display = 'none'; return; }
        section.style.display = 'block';
        const top5 = [...expenses].sort((a, b) => b.amt - a.amt).slice(0, 5);
        list.innerHTML = '';
        top5.forEach((item, i) => {
            list.innerHTML += `<div class="top-item"><span>${i+1}. ${item.desc}</span><b>${item.amt.toLocaleString()}</b></div>`;
        });
    }

    function updateGrade(inc, exp) {
        const box = document.getElementById('gradeBox');
        const letter = document.getElementById('gradeLetter');
        if (inc === 0) { letter.innerText = "-"; return; }
        const ratio = (exp / inc) * 100;
        let g, cl;
        if (ratio <= 35) { g='A'; cl='status-A'; }
        else if (ratio <= 50) { g='B'; cl='status-B'; }
        else if (ratio <= 75) { g='C'; cl='status-C'; }
        else if (ratio <= 95) { g='D'; cl='status-D'; }
        else { g='F'; cl='status-F'; }
        box.className = 'grade-card ' + cl;
        letter.innerText = g;
        document.getElementById('gradeLabel').innerText = `‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ ${ratio.toFixed(0)}% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö`;
    }

    function updateChart(data) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if (chartObj) chartObj.destroy();

        // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        const summary = data.reduce((acc, curr) => {
            const key = curr.desc;
            if (!acc[key]) acc[key] = { amt: 0, type: curr.type };
            acc[key].amt += curr.amt;
            return acc;
        }, {});

        const labels = Object.keys(summary);
        const values = labels.map(l => summary[l].amt);
        const colors = labels.map(l => summary[l].type === 'inc' ? '#2ecc71' : '#e74c3c');

        chartObj = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: colors,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => ` ${context.label}: ${context.raw.toLocaleString()} ‡∏ö‡∏≤‡∏ó`
                        }
                    }
                }
            }
        });
    }

    document.getElementById('addBtn').onclick = function() {
        const d = document.getElementById('desc').value;
        const a = parseFloat(document.getElementById('amt').value.replace(/,/g, ""));
        const t = document.getElementById('type').value;
        if(!d || isNaN(a)) return;
        db.unshift({ desc: d, amt: a, type: t });
        localStorage.setItem('my_wallet_v7', JSON.stringify(db));
        document.getElementById('desc').value = '';
        document.getElementById('amt').value = '';
        render();
    };

    function deleteItem(index) {
        if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
            db.splice(index, 1);
            localStorage.setItem('my_wallet_v7', JSON.stringify(db));
            render();
        }
    }

    function resetData() { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { db=[]; localStorage.removeItem('my_wallet_v7'); render(); } }
    window.onload = render;
</script>

</body>
</html>
